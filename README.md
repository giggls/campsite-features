# OpenCampingMap campsite features layer

The campsite features layer is currently generated by [MapServer](https://mapserver.org/).

The following is an (likely incomplete) instruction for installing this on
Debian/Ubuntu where the direct call of the mapserv binary has been masked
using mod_rewrite for security reasons.

This will need a running instance of [osmpoidb](https://github.com/giggls/osmpoidb).

1. Create a symbolic link from mapserv cgi into your local www-root:
```sh 
ln -s /usr/lib/cgi-bin/mapserv mapserv.fcgi
```

2. Install libapache2-mod-fcgid and cgi-mapserver:
```sh 
apt install libapache2-mod-fcgid cgi-mapserver
```

4. Hide the `mapserv.fcgi` by Apache rewrite rule (adapt path to `camp-pitches.map` in example):

```
# This will deny a direct call of mapserv cgi
RewriteRule "^/mapserv.fcgi" "-" [F]
# This will redirect a tile URL request to mapserv cgi
RewriteRule ^/camping_features/+([0-9]+)/+([0-9]+)/([0-9]+)\.png$ /cgi-bin/mapserv?MAP=/osm/camping/pitch-layer/camp-pitches.map&MODE=tile&TILEMODE=gmap&FORMAT=image/png&LAYERS=default&TILE=$2+$3+$1 [PT]
```

5. Adapt path to `notofonts.lst` in `camp-pitches.map`.

6. Restart Apache webserver.
